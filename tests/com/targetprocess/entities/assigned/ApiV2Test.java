package com.targetprocess.entities.assigned;

import com.google.gson.Gson;
import junit.framework.TestCase;
import org.jetbrains.annotations.NotNull;
import org.jetbrains.annotations.Nullable;

import java.io.UnsupportedEncodingException;
import java.net.URLEncoder;
import java.util.Arrays;

public class ApiV2Test extends TestCase {

    public void testGetRequestUrlForEmptyQuery() {
        assertEquals("http://localhost/targetprocess/api/v2/assignable" +
                "?select=" + encodeUrl("{id,name,description,entityType:entityType.name}") +
                "&where=" + encodeUrl("(assignedUser.where(it.login=='user').Count>0)and(entityType.name=='Bug' or entityType.name=='UserStory' or entityType.name=='Task')and(entityState.isFinal==false)") +
                "&orderBy=" + encodeUrl("id desc"),
            getRequestUrl(null));

        assertEquals("http://localhost/targetprocess/api/v2/assignable" +
                "?select=" + encodeUrl("{id,name,description,entityType:entityType.name}") +
                "&where=" + encodeUrl("(assignedUser.where(it.login=='user').Count>0)and(entityType.name=='Bug' or entityType.name=='UserStory' or entityType.name=='Task')and(entityState.isFinal==false)") +
                "&orderBy=" + encodeUrl("id desc"),
            getRequestUrl(""));
    }

    public void testGetRequestUrlForZeroOffsetAndLimit() {
        assertEquals("http://localhost/targetprocess/api/v2/assignable" +
                "?select=" + encodeUrl("{id,name,description,entityType:entityType.name}") +
                "&where=" + encodeUrl("(assignedUser.where(it.login=='user').Count>0)and(entityType.name=='Bug' or entityType.name=='UserStory' or entityType.name=='Task')and(entityState.isFinal==false)") +
                "&orderBy=" + encodeUrl("id desc"),
            getRequestUrl("", 0, 0));
    }

    public void testGetRequestUrl() {
        assertEquals("http://localhost/targetprocess/api/v2/assignable" +
                "?select=" + encodeUrl("{id,name,description,entityType:entityType.name}") +
                "&where=" + encodeUrl("(assignedUser.where(it.login=='user').Count>0)and(entityType.name=='Bug' or entityType.name=='UserStory' or entityType.name=='Task')and(entityState.isFinal==false)and(name.contains('code') or id.ToString().contains('code'))") +
                "&orderBy=" + encodeUrl("id desc") +
                "&take=20&skip=0",
            getRequestUrl("code", 0, 20));

        assertEquals("http://localhost/targetprocess/api/v2/assignable" +
                "?select=" + encodeUrl("{id,name,description,entityType:entityType.name}") +
                "&where=" + encodeUrl("(assignedUser.where(it.login=='user').Count>0)and(entityType.name=='Bug' or entityType.name=='UserStory' or entityType.name=='Task')and(entityState.isFinal==false)and(name.contains('code') or id.ToString().contains('code'))") +
                "&orderBy=" + encodeUrl("id desc") +
                "&take=100&skip=20",
            getRequestUrl("code", 20, 100));
    }

    public void testDeserialization() {
        String responseString = "{\"items\":[" +
            "{" +
            "\"id\":65330," +
            "\"name\":\"Browser performance - layout invalidation in columns resizer\"," +
            "\"description\":\"<div>gridResizeTrigger.attachTo&#40;&#41; in ui.board.plus.decorator.columns-resize.js invalidates the whole layout&#44; then setPosition&#40;&#41; in ui.board.plus.decorator.quick-add-cells.js forces layout</div>\\n\"," +
            "\"entityType\":\"Bug\",\"entityState\":{\"id\":5,\"name\":\"Open\",\"isFinal\":false}" +
            "}," +
            "{\"id\":68750,\"name\":\"Animation of a failed prioritization: highlight the entity with yellow when it's back to its initial position\",\"description\":\"<div>Given board with prioritization on SHIFT held</div>\\n\\n<div>And it&#39;s ordered by rank</div>\\n\\n<div> </div>\\n\\n<div>When I drag an entity to the new position</div>\\n\\n<div>And drop it</div>\\n\\n<div>And prioritization is not performed</div>\\n\\n<div>And entity gets back to its initial position</div>\\n\\n<div> </div>\\n\\n<div>Then it should be highlighted with yellow  &#40;as it blinks when gets to the new position if prioritization was successful&#41;</div>\\n\\n<div> </div>\\n\\n<div>Animation in this case should be in the same way as on the board</div>\\n\\n<div> </div>\\n\",\"entityType\":\"Bug\",\"entityState\":{\"id\":5,\"name\":\"Open\",\"isFinal\":false}}," +
            "{\"id\":68865,\"name\":\"Pearls of Functional Algorithm Design\",\"entityType\":\"UserStory\",\"entityState\":{\"id\":1164,\"name\":\"In Stock/Reading\",\"isFinal\":false}}," +
            "{\"id\":68941,\"name\":\"Thinking, Fast and Slow\",\"description\":\"<div><span style=\\\"color:rgb(0, 0, 0); font-family:sans-serif; font-size:13px\\\">The book&#39;s central thesis is a dichotomy between two modes of thought&#58; </span><em>System 1</em><span style=\\\"color:rgb(0, 0, 0); font-family:sans-serif; font-size:13px\\\"> is fast&#44; instinctive and emotional&#59; </span><em>System 2</em><span style=\\\"color:rgb(0, 0, 0); font-family:sans-serif; font-size:13px\\\"> is slower&#44; more deliberative&#44; and more logical. The book delineates cognitive biases associated with each type of thinking&#44; starting with Kahneman&#39;s own research on </span><a href=\\\"http&#58;&#47;&#47;en.wikipedia.org&#47;wiki&#47;Loss_aversion\\\" target=\\\"_blank\\\">loss aversion</a><span style=\\\"color:rgb(0, 0, 0); font-family:sans-serif; font-size:13px\\\">. From framing choices to substitution&#44; the book highlights several decades of academic research to suggest that people place too much confidence in human judgment.</span></div>\\n\",\"entityType\":\"UserStory\",\"entityState\":{\"id\":1164,\"name\":\"In Stock/Reading\",\"isFinal\":false}}," +
            "{\"id\":75554,\"name\":\"JS Code Coverage\",\"entityType\":\"UserStory\",\"entityState\":{\"id\":899,\"name\":\"Open\",\"isFinal\":false}}," +
            "{\"id\":81332,\"name\":\"Eclipse connector is unable to commit changes to TP in Eclipse - regression\",\"description\":\"<div>Prerequisites&#58;</div>\\r\\n\\n<div>Eclipse 3.7.2 &#40;Indigo&#41; http&#58;&#47;&#47;archive.eclipse.org&#47;eclipse&#47;downloads&#47;drops&#47;R-3.7.2-201202080800&#47;</div>\\r\\n\\n<div>Mylyn 3.7.1 from http&#58;&#47;&#47;download.eclipse.org&#47;mylyn&#47;releases&#47;3.7</div>\\r\\n\\n<div>OR</div>\\r\\n\\n<div>\\r\\n<p><span style=\\\"background-color:transparent; font-size:15px\\\">Eclipse Juno 3.8</span><span style=\\\"background-color:transparent; font-size:15px\\\">&#58; </span><a href=\\\"http&#58;&#47;&#47;archive.eclipse.org&#47;eclipse&#47;downloads&#47;drops&#47;R-3.8.2-201301310800&#47;\\\" target=\\\"_blank\\\"><u>http&#58;&#47;&#47;archive.eclipse.org&#47;eclipse&#47;downloads&#47;drops&#47;R-3.8.2-201301310800&#47;</u></a></p>\\r\\n<span style=\\\"background-color:transparent; font-size:15px\\\">Mylyn 3.11&#58; </span><a href=\\\"http&#58;&#47;&#47;download.eclipse.org&#47;mylyn&#47;releases&#47;latest\\\" target=\\\"_blank\\\"><u>http&#58;&#47;&#47;download.eclipse.org&#47;mylyn&#47;releases&#47;latest</u></a></div>\\r\\n\\n<div>OR</div>\\r\\n\\n<div>\\r\\n<p><span style=\\\"background-color:transparent; font-size:15px\\\">Eclipse Juno 4.2.2&#58; </span><a href=\\\"http&#58;&#47;&#47;archive.eclipse.org&#47;eclipse&#47;downloads&#47;drops4&#47;R-4.2.2-201302041200&#47;\\\" target=\\\"_blank\\\"><u>http&#58;&#47;&#47;archive.eclipse.org&#47;eclipse&#47;downloads&#47;drops4&#47;R-4.2.2-201302041200&#47;</u></a></p>\\r\\n\\n<div><a href=\\\"http&#58;&#47;&#47;download.eclipse.org&#47;mylyn&#47;releases&#47;latest\\\" target=\\\"_blank\\\"><span style=\\\"background-color:transparent; font-size:15px\\\">Mylyn 3.11&#58; </span>http&#58;&#47;&#47;download.eclipse.org&#47;mylyn&#47;releases&#47;latest</a></div>\\r\\n\\n<div>OR</div>\\r\\n\\n<div>\\r\\n<p><span style=\\\"background-color:transparent; font-size:15px\\\">Eclipse Kepler 4.3.2</span></p>\\r\\n\\n<p><span style=\\\"background-color:transparent; font-size:15px\\\">Eclipse IDE&#58; </span><a href=\\\"http&#58;&#47;&#47;download.eclipse.org&#47;eclipse&#47;downloads&#47;drops4&#47;R-4.3.2-201402211700&#47;\\\" target=\\\"_blank\\\"><u>http&#58;&#47;&#47;download.eclipse.org&#47;eclipse&#47;downloads&#47;drops4&#47;R-4.3.2-201402211700&#47;</u></a></p>\\r\\n<span style=\\\"background-color:transparent; font-size:15px\\\">Mylyn 3.11&#58; </span><a href=\\\"http&#58;&#47;&#47;download.eclipse.org&#47;mylyn&#47;releases&#47;latest\\\" target=\\\"_blank\\\"><u>http&#58;&#47;&#47;download.eclipse.org&#47;mylyn&#47;releases&#47;latest</u></a></div>\\r\\n\\n<div> </div>\\r\\n</div>\\r\\n\\n<div>AND</div>\\r\\n\\n<div><span style=\\\"background-color:rgb(255, 255, 255)\\\">Targetprocess connector in Eclipse&#58; 3.0.3  from ftp.targetprocess.com customer&#47;customer Mylyn_3.0.3 FTP folder</span></div>\\r\\n\\n<div><span style=\\\"background-color:rgb(255, 255, 255)\\\">TP version 3.2.2 &#40;plan.tpondemand.com&#41;</span></div>\\r\\n\\n<div> </div>\\r\\n\\n<div>How to reproduce&#58;</div>\\r\\n\\n<ol>\\r\\n\\t<li>Run Eclipse&#44; check that every required module is installed</li>\\r\\n\\t<li>Window -&gt; Show View - Other... -&gt; Mylyn -&gt; Task List</li>\\r\\n\\t<li>In the Task List -&gt; New-&gt;Query</li>\\r\\n\\t<li>Add Task Repository&#44; Targetprocess&#44; https&#58;&#47;&#47;plan.tpondemand.com&#44; repository name is blank&#44; fill in your credentials from Plan. Check Connection is successful - status message Authentication credentials are valid.</li>\\r\\n\\t<li>Query title is TP</li>\\r\\n\\t<li>Tasks are downloaded OK</li>\\r\\n\\t<li>Double-click on a User Story to open it</li>\\r\\n\\t<li>Try to change state &#47; Description &#47; Rename Task &#47; Submit new comment.</li>\\r\\n\\t<li>Press Submit button in the top right corner</li>\\r\\n\\t<li>See error message&#58; Submit failed&#58; org.apache.axis2.databinding.ADBException&#58; Unexpected subelement PlannedStartDate</li>\\r\\n</ol>\\r\\n\\n<div><img src=\\\"/Attachment.aspx?AttachmentID=357519\\\" /></div>\\r\\n\\n<div> </div>\\r\\n\\n<div>The issue should be fixed for all supported items&#58; User Stories&#44; Tasks&#44; Bugs&#44; Requests etc.</div>\\r\\n\\n<div> </div>\\r\\n\\n<div>Expected results&#58; changes &#40;new Name &#47; State &#47; Description &#47; new Comment&#41; are saved&#44; when you open and check them in TP&#44; the items are updated.</div>\\r\\n\\n<div> </div>\\r\\n\\n<div>IMPORTANT&#58; notify customers&#44; that Mylyn v3.11 is required&#33; It can be downloaded at <a href=\\\"http&#58;&#47;&#47;download.eclipse.org&#47;mylyn&#47;releases&#47;latest\\\" target=\\\"_blank\\\">http&#58;&#47;&#47;download.eclipse.org&#47;mylyn&#47;releases&#47;latest</a></div>\\r\\n\\n<div>Mylyn v3.10 has a Bug that prevents Targetprocess Connector from normal work.</div>\\r\\n\",\"entityType\":\"Bug\",\"entityState\":{\"id\":5,\"name\":\"Open\",\"isFinal\":false}}," +
            "{\"id\":90601,\"name\":\"Empty pages on boards with hidden empty rows and columns\",\"description\":\"<div style=\\\"text-align:start\\\">\\r\\n<div>When you have a large list of results on a view and have hidden empty rows&#44; the empty rows are still included in the pagination.</div>\\r\\n\\n<div> </div>\\r\\n\\n<div>If I have tasks by tags and the tags are the rows&#44; when you hide empty rows you end up with lots of empty pagination screens between displayed non-empty rows.</div>\\r\\n</div>\\r\\n\",\"entityType\":\"Bug\",\"entityState\":{\"id\":5,\"name\":\"Open\",\"isFinal\":false}}," +
            "{\"id\":93959,\"name\":\"mylyn connector submit failure - unexpected subelement\",\"description\":\"<div>GIVEN I have my Eclipse configured<br />\\r\\nAND I open Help - About section<br />\\r\\nThere is no Targetprocess icon in there<br />\\r\\nhttp&#58;&#47;&#47;prntscr.com&#47;5curlw<br />\\r\\nAND there is no information about Targetprocess Mylyn connector at Features tab of Installation details dialogue<br />\\r\\nhttp&#58;&#47;&#47;prntscr.com&#47;5cur2s</div>\\r\\n\",\"entityType\":\"Bug\",\"entityState\":{\"id\":5,\"name\":\"Open\",\"isFinal\":false}}," +
            "{\"id\":98555,\"name\":\"Keyboard does not work after List mode updates\",\"description\":\"<div>When viewing a view as a list&#44; if you try to assign a user story in the list&#44; it opens the search window&#44; but hangs.  No items are found and you can&#39;t select anything&#44; close the window&#44; etc. To fix you have to reload the page.</div>\\n\\n<div> </div>\\n\\n<div>- Cognosante&#44; On-Site TPv3.5.5.13975</div>\\n\\n<div> </div>\\n\\n<div> </div>\\n\\n<div>\\n<div>This week I&#39;ve started to experience the problem with the search tool&#58; it just stops working from time to time. After using TP for some time I enter issue number&#44; press &quot;Enter&quot; and nothing happens. No JS errors at console.<br />\\nRemoving of the the issue number and type it again&#44; closing the tool with &quot;X&quot; mark and open it again doesn&#39;t help.<br />\\nHave to reload the page to continue my work. I use latest Chrome.</div>\\n\\n<div> </div>\\n\\n<div>- Molecular Health&#44; On-Demands</div>\\n</div>\\n\",\"entityType\":\"Bug\",\"entityState\":{\"id\":5,\"name\":\"Open\",\"isFinal\":false}}," +
            "{\"id\":99359,\"name\":\"Date/time units: format string is parsed on each unit render\",\"entityType\":\"UserStory\",\"entityState\":{\"id\":1,\"name\":\"Open\",\"isFinal\":false}}," +
            "{\"id\":99467,\"name\":\"Project, Program name is set to previous one visually if change it right after opening Project View\",\"description\":\"<div>GIVEN Project view is opened</div>\\r\\n\\n<div>WHEN I rename it</div>\\r\\n\\n<div>THEN  new name should be displayed</div>\\r\\n\\n<div>   But   now project name is set to previous one.</div>\\r\\n\",\"entityType\":\"Bug\",\"entityState\":{\"id\":5,\"name\":\"Open\",\"isFinal\":false}}," +
            "{\"id\":104541,\"name\":\"TargetProcess Issue: Prioritization using Drag & Drop not refreshing - clearevent.tpondemand.com\",\"description\":\"<div>WHEN I create a view from &#39;Epics&#44; Features and Stories&#39; template</div>\\r\\n\\n<div>THEN I cannot prioritize epics</div>\\r\\n\\n<div>BUT I should be able to do that</div>\\r\\n\\n<div> </div>\\r\\n\\n<div>the reason is default Project sorting instead of Rank&#44; so workaround is easy&#59; however&#44; the issue is confusing for the customer</div>\\r\\n\",\"entityType\":\"Bug\",\"entityState\":{\"id\":5,\"name\":\"Open\",\"isFinal\":false}},{\"id\":107538,\"name\":\"Create additional dashboard usage reports\",\"description\":\"<!--markdown-->List of reports:\\n\\n[\\\\# of db visits](http://taus.tpminsk.by/#/visualize/edit/Dashboard-views?_g=%28refreshInterval%3A%28display%3AOff,section%3A0,value%3A0%29,time%3A%28from%3Anow-90d,mode%3Aquick,to%3Anow%29%29&_a=%28filters%3A!%28%29,linked%3A!f,query%3A%28query_string%3A%28analyze_wildcard%3A!t,query%3A'*'%29%29,vis%3A%28aggs%3A!%28%28id%3A'1',params%3A%28%29,schema%3Ametric,type%3Acount%29,%28id%3A'3',params%3A%28extended_bounds%3A%28%29,field%3Adate,interval%3Aweek,min_doc_count%3A1%29,schema%3Asegment,type%3Adate_histogram%29,%28id%3A'2',params%3A%28field%3AitemType,order%3Adesc,orderBy%3A'1',size%3A5%29,schema%3Agroup,type%3Aterms%29%29,listeners%3A%28%29,params%3A%28addLegend%3A!t,addTooltip%3A!t,defaultYExtents%3A!f,shareYAxis%3A!t%29,type%3Aline%29%29)\\n[\\\\# of unique db visited](http://taus.tpminsk.by/#/visualize/edit/Dashboard-unique-views?_g=%28refreshInterval%3A%28display%3AOff,section%3A0,value%3A0%29,time%3A%28from%3Anow-90d,mode%3Aquick,to%3Anow%29%29&_a=%28filters%3A!%28%29,linked%3A!f,query%3A%28query_string%3A%28analyze_wildcard%3A!t,query%3A'*'%29%29,vis%3A%28aggs%3A!%28%28id%3A'1',params%3A%28field%3Aid%29,schema%3Ametric,type%3Acardinality%29,%28id%3A'3',params%3A%28extended_bounds%3A%28%29,field%3Adate,interval%3Aweek,min_doc_count%3A1%29,schema%3Asegment,type%3Adate_histogram%29,%28id%3A'2',params%3A%28field%3AitemType,order%3Adesc,orderBy%3A'1',size%3A5%29,schema%3Agroup,type%3Aterms%29%29,listeners%3A%28%29,params%3A%28addLegend%3A!t,addTooltip%3A!t,defaultYExtents%3A!f,shareYAxis%3A!t%29,type%3Aline%29%29)\\n[\\\\# of db used (active) per account](http://taus.tpminsk.by/#/visualize/edit/Dashboards-used-per-account?_g=%28refreshInterval%3A%28display%3AOff,section:0,value:0%29,time%3A%28from:now-90d,mode:quick,to:now%29%29&_a=%28filters:!%28%29,linked:!f,query%3A%28query_string%3A%28analyze_wildcard:!t,query:'itemType:%20%22dashboard%22'%29%29,vis%3A%28aggs:!%28%28id:'1',params%3A%28field:id%29,schema:metric,type:cardinality%29,%28id:'2',params%3A%28field:host.id,include%3A%28pattern:.%2B.tpondemand.com%29,order:desc,orderBy:'1',size:20%29,schema%3Asegment,type:terms%29%29,listeners%3A%28%29,params%3A%28addLegend:!t,addTooltip:!t,defaultYExtents:!f,mode%3Astacked,shareYAxis:!t%29,type:histogram%29%29)\\n\\nReports which require additional data:\\n\\n[\\\\# of db visits per account](<http://taus.tpminsk.by/#/visualize/edit/Dashboards-accounts-with-top-dashboard-views?_g=%28refreshInterval:%28display:Off,pause:!f,section:0,value:0),time:%28from:now-90d,mode:quick,to:now))&_a=%28filters:!%28),linked:!f,query:%28query_string:%28analyze_wildcard:!t,query:'itemType:%20%22dashboard%22')),vis:%28aggs:!%28%28id:'1',params:%28),schema:metric,type:count),%28id:'3',params:%28exclude:%28pattern:protasevichrules%5C.tpondemand%5C.com),field:host.id,size:10),schema:group,type:significant_terms),%28id:'4',params:%28customInterval:'2h',extended_bounds:%28),field:date,interval:w,min_doc_count:1),schema:segment,type:date_histogram)),listeners:%28),params:%28addLegend:!t,addTimeMarker:!f,addTooltip:!t,defaultYExtents:!f,drawLinesBetweenPoints:!t,interpolate:linear,radiusRatio:9,scale:linear,setYExtents:!f,shareYAxis:!t,showCircles:!t,smoothLines:!f,times:!%28),yAxis:%28)),type:line))>)\\n\\\\# of db visits per user\\ndb updates\\n[layout popularity](<http://taus.tpminsk.by/#/visualize/edit/Dashboard-layout-columns-popularity?_g=%28refreshInterval:%28display:Off,pause:!f,section:0,value:0),time:%28from:now-30d,mode:quick,to:now))&_a=%28filters:!%28),linked:!f,query:%28query_string:%28analyze_wildcard:!t,query:'itemType:%20%22dashboard%22')),vis:%28aggs:!%28%28id:'1',params:%28field:id),schema:metric,type:cardinality),%28id:'2',params:%28extended_bounds:%28),field:layoutColumnsCount,interval:1),schema:segment,type:histogram)),listeners:%28),params:%28addLegend:!t,addTimeMarker:!f,addTooltip:!t,defaultYExtents:!f,mode:stacked,scale:linear,setYExtents:!f,shareYAxis:!t,spyPerPage:10,times:!%28),yAxis:%28)),type:histogram))>)\\n[\\\\# of widgets per db](<http://taus.tpminsk.by/#/visualize/edit/Dashboard-layout-count-of-widgets?_g=%28refreshInterval:%28display:Off,pause:!f,section:0,value:0),time:%28from:now-30d,mode:quick,to:now))&_a=%28filters:!%28),linked:!f,query:%28query_string:%28analyze_wildcard:!t,query:'itemType:%20%22dashboard%22%20AND%20widgetsCount:%20%3E0')),vis:%28aggs:!%28%28id:'1',params:%28field:id),schema:metric,type:cardinality),%28id:'2',params:%28extended_bounds:%28),field:widgetsCount,interval:1,min_doc_count:!f),schema:segment,type:histogram)),listeners:%28),params:%28addLegend:!t,addTimeMarker:!f,addTooltip:!t,defaultYExtents:!f,mode:stacked,scale:linear,setYExtents:!f,shareYAxis:!t,spyPerPage:10,times:!%28),yAxis:%28)),type:histogram))>)\\n[widgets popularity](<http://taus.tpminsk.by/#/visualize/edit/Dashboards-widget-popularity?_g=%28refreshInterval:%28display:Off,pause:!f,section:0,value:0),time:%28from:now-30d,mode:quick,to:now))&_a=%28filters:!%28),linked:!f,query:%28query_string:%28analyze_wildcard:!t,query:'itemType:%20%22dashboard%22')),vis:%28aggs:!%28%28id:'1',params:%28field:id),schema:metric,type:cardinality),%28id:'2',params:%28field:widgetTemplates,order:desc,orderBy:'1',size:40),schema:segment,type:terms)),listeners:%28),params:%28addLegend:!t,addTimeMarker:!f,addTooltip:!t,defaultYExtents:!f,mode:stacked,scale:linear,setYExtents:!f,shareYAxis:!t,spyPerPage:10,times:!%28),yAxis:%28)),type:histogram))>)\\nsession duration?\\n\",\"entityType\":\"UserStory\",\"entityState\":{\"id\":1,\"name\":\"Open\",\"isFinal\":false}},{\"id\":108793,\"name\":\"Add last events from tauspy to js errors reporting\",\"description\":\"<!--markdown-->Last action / last X events \",\"entityType\":\"UserStory\",\"entityState\":{\"id\":158,\"name\":\"Planned\",\"isFinal\":false}},{\"id\":108918,\"name\":\"All 'bus destroy' should call `this._super();`\",\"entityType\":\"Bug\",\"entityState\":{\"id\":5,\"name\":\"Open\",\"isFinal\":false}},{\"id\":111014,\"name\":\"# of db visits per account\",\"entityType\":\"Task\",\"entityState\":{\"id\":80,\"name\":\"In Dev\",\"isFinal\":false}},{\"id\":111236,\"name\":\"Unify browser detection code\",\"description\":\"<!--markdown-->- tau/services/browser.detector - `isPhantomJS()`\\n- tau/core/tau - `getIEVersion()`, `ieVersion`\\n- tau/services/service.diagnostics - `_detectBrowser()`\\n- tracking/extensions/session (based on 3rd party session.js) - `browser.detect()`\\n\",\"entityType\":\"UserStory\",\"entityState\":{\"id\":1,\"name\":\"Open\",\"isFinal\":false}},{\"id\":114076,\"name\":\"Remove deprecated list ordering code/data\",\"description\":\"<!--markdown-->1. Enable code `_removeFromRestStorage()` that removes old list ordering from client storage, when current code will be in stable release.\\n2. Remove migration code in `DeprecatedClientOrdering` when migration will be done.\",\"entityType\":\"UserStory\",\"entityState\":{\"id\":1,\"name\":\"Open\",\"isFinal\":false}},{\"id\":114312,\"name\":\"Add 'Assign to me' to the context menu\",\"entityType\":\"UserStory\",\"entityState\":{\"id\":158,\"name\":\"Planned\",\"isFinal\":false}},{\"id\":116592,\"name\":\"Client sorting by Money CF in lists does not work\",\"description\":\"<!--markdown-->Steps to reproduce:\\n\\n1. Create custom field of type money for User Story\\n2. Create list with User Stories as cards\\n3. Customize list - add money custom field\\n4. Sort by money field\\n\",\"entityType\":\"Bug\",\"entityState\":{\"id\":5,\"name\":\"Open\",\"isFinal\":false}},{\"id\":119013,\"name\":\"XSS in \\\"Cleanup Sample Data\\\" in Settings\",\"description\":\"<!--markdown-->Steps to reproduce:\\n\\n1. Rename default entity (project/user), e.g. Project: `Tau Product Web Site - Scrum #1</script><script>alert(2)</script>`\\n2. Open Settings popup\\n\\nSettings item \\\"Cleanup Sample Data\\\" will execute injected script\",\"entityType\":\"Bug\",\"entityState\":{\"id\":160,\"name\":\"Planned\",\"isFinal\":false}}]}";
        Gson gson = new Gson();
        AssignablesWrapper response = gson.fromJson(responseString, AssignablesWrapper.class);
        System.out.println(Arrays.toString(response.getItems()));
    }

    private static String getRequestUrl(@Nullable String query) {
        return TargetprocessRepository
            .getRequestUrl("http://localhost/targetprocess", "user", query)
            .toString();
    }

    private static String getRequestUrl(@Nullable String query, int offset, int limit) {
        return TargetprocessRepository
            .getRequestUrl("http://localhost/targetprocess", "user", query, offset, limit)
            .toString();
    }

    private static String encodeUrl(@NotNull String s) {
        try {
            return URLEncoder.encode(s, "UTF-8");
        } catch (UnsupportedEncodingException e) {
            throw new RuntimeException(e);
        }
    }

}
